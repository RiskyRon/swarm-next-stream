## getscripts_frontend.py

```typescript
import os
import re

def generate_md_from_tsx_ts(output_file='output.md'):
    excluded_dirs = {'node_modules', '.next', 'venv', '__pycache__', '.git', 'ui', 'WORKSPACE', 'backend'}
    excluded_files = {'next-env.d.ts', 'get_scripts.py', 'url_screenshot.py', 'output.md', 'assistants_api.md'}

    with open(output_file, 'w', encoding='utf-8') as f:
        for root, dirs, files in os.walk('.'):
            dirs[:] = [d for d in dirs if d not in excluded_dirs]
            
            for file in files:
                if file.endswith(('.tsx', '.ts', '.py', '.css')) and file not in excluded_files:
                    file_path = os.path.join(root, file)
                    relative_path = os.path.relpath(file_path)
                    
                    f.write(f"## {relative_path}\n\n")
                    f.write("```typescript\n")
                    
                    with open(file_path, 'r', encoding='utf-8') as script_file:
                        content = script_file.read()
                        # Remove BOM if present
                        content = re.sub(r'^\ufeff', '', content)
                        f.write(content)
                    
                    f.write("\n```\n\n")

    print(f"Markdown file '{output_file}' has been generated.")

# Usage
generate_md_from_tsx_ts()
```

## frontend/tailwind.config.ts

```typescript
import type { Config } from "tailwindcss";

const config: Config = {
    darkMode: ["class"],
    content: [
    "./pages/**/*.{js,ts,jsx,tsx,mdx}",
    "./components/**/*.{js,ts,jsx,tsx,mdx}",
    "./app/**/*.{js,ts,jsx,tsx,mdx}",
  ],
  theme: {
  	extend: {
  		colors: {
  			background: 'hsl(var(--background))',
  			foreground: 'hsl(var(--foreground))',
  			card: {
  				DEFAULT: 'hsl(var(--card))',
  				foreground: 'hsl(var(--card-foreground))'
  			},
  			popover: {
  				DEFAULT: 'hsl(var(--popover))',
  				foreground: 'hsl(var(--popover-foreground))'
  			},
  			primary: {
  				DEFAULT: 'hsl(var(--primary))',
  				foreground: 'hsl(var(--primary-foreground))'
  			},
  			secondary: {
  				DEFAULT: 'hsl(var(--secondary))',
  				foreground: 'hsl(var(--secondary-foreground))'
  			},
  			muted: {
  				DEFAULT: 'hsl(var(--muted))',
  				foreground: 'hsl(var(--muted-foreground))'
  			},
  			accent: {
  				DEFAULT: 'hsl(var(--accent))',
  				foreground: 'hsl(var(--accent-foreground))'
  			},
  			destructive: {
  				DEFAULT: 'hsl(var(--destructive))',
  				foreground: 'hsl(var(--destructive-foreground))'
  			},
  			border: 'hsl(var(--border))',
  			input: 'hsl(var(--input))',
  			ring: 'hsl(var(--ring))',
  			chart: {
  				'1': 'hsl(var(--chart-1))',
  				'2': 'hsl(var(--chart-2))',
  				'3': 'hsl(var(--chart-3))',
  				'4': 'hsl(var(--chart-4))',
  				'5': 'hsl(var(--chart-5))'
  			}
  		},
  		borderRadius: {
  			lg: 'var(--radius)',
  			md: 'calc(var(--radius) - 2px)',
  			sm: 'calc(var(--radius) - 4px)'
  		}
  	}
  },
  plugins: [require("tailwindcss-animate")],
};
export default config;

```

## frontend/app/layout.tsx

```typescript
import type { Metadata } from "next";
import localFont from "next/font/local";
import "./globals.css";

const geistSans = localFont({
  src: "./fonts/GeistVF.woff",
  variable: "--font-geist-sans",
  weight: "100 900",
});
const geistMono = localFont({
  src: "./fonts/GeistMonoVF.woff",
  variable: "--font-geist-mono",
  weight: "100 900",
});

export const metadata: Metadata = {
  title: "Create Next App",
  description: "Generated by create next app",
};

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  return (
    <html lang="en">
      <body
        className={`${geistSans.variable} ${geistMono.variable} antialiased`}
      >
        {children}
      </body>
    </html>
  );
}

```

## frontend/app/page.tsx

```typescript
import ChatBot from '@/components/Chatbot';

export default function Home() {
  return (
    <main className="flex min-h-screen flex-col items-center justify-between p-24">
      <ChatBot />
    </main>
  );
}
```

## frontend/app/globals.css

```typescript
@tailwind base;
@tailwind components;
@tailwind utilities;

body {
  font-family: Arial, Helvetica, sans-serif;
}

@layer utilities {
  .text-balance {
    text-wrap: balance;
  }

  .scrollbar-custom {
    scrollbar-width: thin;
    scrollbar-color: var(--muted-foreground) transparent;
  }

  .scrollbar-custom::-webkit-scrollbar {
    width: 8px;
    height: 8px;
  }

  .scrollbar-custom::-webkit-scrollbar-track {
    background: transparent;
  }

  .scrollbar-custom::-webkit-scrollbar-thumb {
    background-color: var(--muted-foreground);
    opacity: 0.5;
    border-radius: 4px;
  }

  .scrollbar-custom::-webkit-scrollbar-thumb:hover {
    opacity: 0.8;
  }

  .scrollbar-custom::-webkit-scrollbar-thumb:horizontal {
    border-radius: 4px;
  }
}

@layer base {
  :root {
    /* Direct color values for picker */
    --background-color: hsl(240, 90%, 3.9%);
    --foreground-color: hsl(0, 0%, 98%);
    --card-color: hsl(240, 90%, 3.9%);
    --card-foreground-color: hsl(0, 0%, 98%);
    --popover-color: hsl(240 90% 3.9%);
    --popover-foreground-color: hsl(0, 0%, 98%);
    --primary-color: hsl(0, 0%, 98%);
    --primary-foreground-color: hsl(240, 5.9%, 10%);
    --secondary-color: hsl(240, 3.7%, 15.9%);
    --secondary-foreground-color: hsl(0, 0%, 98%);
    --muted-color: hsl(240, 3.7%, 15.9%);
    --muted-foreground-color: hsl(240, 5%, 64.9%);
    --accent-color: hsl(178, 94%, 44%);
    --accent-foreground-color: hsl(0, 0%, 98%);
    --destructive-color: hsl(0, 62.8%, 30.6%);
    --destructive-foreground-color: hsl(0, 0%, 98%);
    --border-color: hsl(240, 3.7%, 15.9%);
    --input-color: hsl(240, 3.7%, 15.9%);
    --ring-color: hsl(240, 4.9%, 83.9%);
    --chart-1-color: hsl(220, 70%, 50%);
    --chart-2-color: hsl(160, 60%, 45%);
    --chart-3-color: hsl(30, 80%, 55%);
    --chart-4-color: hsl(280, 65%, 60%);
    --chart-5-color: hsl(340, 75%, 55%);
    
    /* Tailwind CSS variables - extracted from the colors above */
    --background: 240 90% 3.9%;
    --foreground: 0 0% 98%;
    --card: 240 90% 3.9%;
    --card-foreground: 0 0% 98%;
    --popover: 240 90% 3.9%;
    --popover-foreground: 0 0% 98%;
    --primary: 0 0% 98%;
    --primary-foreground: 240 5.9% 10%;
    --secondary: 240 90% 3.9%;
    --secondary-foreground: 0 0% 98%;
    --muted: 240 3.7% 15.9%;
    --muted-foreground: 240 5% 64.9%;
    --accent: 178, 94%, 44%;
    --accent-foreground: 0 0% 98%;
    --destructive: 0 62.8% 30.6%;
    --destructive-foreground: 0 0% 98%;
    --border: 240 3.7% 15.9%;
    --input: 240 3.7% 15.9%;
    --ring: 240 4.9% 83.9%;
    --chart-1: 220 70% 50%;
    --chart-2: 160 60% 45%;
    --chart-3: 30 80% 55%;
    --chart-4: 280 65% 60%;
    --chart-5: 340 75% 55%;
    --radius: 0.5rem;
  }

  .light {
    /* Direct color values for picker */
    --background-color: hsl(0, 0%, 100%);
    --foreground-color: hsl(240, 10%, 3.9%);
    --card-color: hsl(0, 0%, 100%);
    --card-foreground-color: hsl(240, 10%, 3.9%);
    --popover-color: hsl(0, 0%, 100%);
    --popover-foreground-color: hsl(240, 10%, 3.9%);
    --primary-color: hsl(240, 5.9%, 10%);
    --primary-foreground-color: hsl(0, 0%, 98%);
    --secondary-color: hsl(240, 4.8%, 95.9%);
    --secondary-foreground-color: hsl(240, 5.9%, 10%);
    --muted-color: hsl(240, 4.8%, 95.9%);
    --muted-foreground-color: hsl(240, 3.8%, 46.1%);
    --accent-color: hsl(240, 4.8%, 95.9%);
    --accent-foreground-color: hsl(240, 5.9%, 10%);
    --destructive-color: hsl(0, 84.2%, 60.2%);
    --destructive-foreground-color: hsl(0, 0%, 98%);
    --border-color: hsl(240, 5.9%, 90%);
    --input-color: hsl(240, 5.9%, 90%);
    --ring-color: hsl(240, 10%, 3.9%);
    --chart-1-color: hsl(12, 76%, 61%);
    --chart-2-color: hsl(173, 58%, 39%);
    --chart-3-color: hsl(197, 37%, 24%);
    --chart-4-color: hsl(43, 74%, 66%);
    --chart-5-color: hsl(27, 87%, 67%);

    /* Tailwind CSS variables - extracted from the colors above */
    --background: 0 0% 100%;
    --foreground: 240 10% 3.9%;
    --card: 0 0% 100%;
    --card-foreground: 240 10% 3.9%;
    --popover: 0 0% 100%;
    --popover-foreground: 240 10% 3.9%;
    --primary: 240 5.9% 10%;
    --primary-foreground: 0 0% 98%;
    --secondary: 240 4.8% 95.9%;
    --secondary-foreground: 240 5.9% 10%;
    --muted: 240 4.8% 95.9%;
    --muted-foreground: 240 3.8% 46.1%;
    --accent: 240 4.8% 95.9%;
    --accent-foreground: 240 5.9% 10%;
    --destructive: 0 84.2% 60.2%;
    --destructive-foreground: 0 0% 98%;
    --border: 240 5.9% 90%;
    --input: 240 5.9% 90%;
    --ring: 240 10% 3.9%;
    --chart-1: 12 76% 61%;
    --chart-2: 173 58% 39%;
    --chart-3: 197 37% 24%;
    --chart-4: 43 74% 66%;
    --chart-5: 27 87% 67%;
  }
}

@layer base {
  * {
    @apply border-border;
  }
  body {
    @apply bg-background text-foreground;
  }
}
```

## frontend/app/api/chat/route.ts

```typescript
import { NextRequest, NextResponse } from 'next/server';

export async function POST(req: NextRequest) {
  const body = await req.json();

  const response = await fetch('http://localhost:8000/chat', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify(body),
  });

  const data = await response.json();

  return NextResponse.json(data);
}
```

## frontend/components/CustomMarkdown.tsx

```typescript
// frontend/components/CustomMarkdown.tsx

import React from 'react';
import ReactMarkdown from 'react-markdown';
import { CustomCodeBlock } from '@/components/CustomCodeBlock';
import { CustomWeatherCard } from '@/components/CustomWeatherCard';
import { LinkIcon } from 'lucide-react';

interface CustomMarkdownProps {
  content: string;
}

export const CustomMarkdown: React.FC<CustomMarkdownProps> = ({ content }) => (
  <ReactMarkdown
    className="prose prose-sm dark:prose-invert max-w-none [&>*:first-child]:mt-0 [&>*:last-child]:mb-0"
    components={{
      code({ node, inline, className, children, ...props }: any) {
        const match = /language-(\w+)/.exec(className || '');
        if (match && match[1] === 'weather') {
          try {
            const data = JSON.parse(String(children).replace(/\n$/, ''));
            return <CustomWeatherCard data={data} />;
          } catch (error) {
            console.error('Error parsing weather data:', error);
            return <div>Error displaying weather data</div>;
          }
        }
        if (inline) {
          return (
            <code className="px-1.5 py-0.5 rounded font-mono text-sm bg-muted text-muted-foreground" {...props}>
              {children}
            </code>
          );
        }
        return (
          <CustomCodeBlock
            inline={inline}
            className={className}
            {...props}
          >
            {children}
          </CustomCodeBlock>
        );
      },
      p: ({ children }) => <p className="mb-4 last:mb-0">{children}</p>,
      ul: ({ children }) => <ul className="list-disc pl-6 mb-4 last:mb-0">{children}</ul>,
      ol: ({ children }) => <ol className="list-decimal pl-6 mb-4 last:mb-0">{children}</ol>,
      li: ({ children }) => <li className="mb-2 last:mb-0">{children}</li>,
      h1: ({ children }) => <h1 className="text-2xl font-bold mb-4 mt-6">{children}</h1>,
      h2: ({ children }) => <h2 className="text-xl font-bold mb-3 mt-5">{children}</h2>,
      h3: ({ children }) => <h3 className="text-lg font-bold mb-2 mt-4">{children}</h3>,
      blockquote: ({ children }) => (
        <blockquote className="border-l-4 border-muted pl-4 italic my-4">
          {children}
        </blockquote>
      ),
      a: ({ href, children }) => {
        // YouTube video handling
        const youtubeMatch = href?.match(/(?:https?:\/\/)?(?:www\.)?(?:youtube\.com\/watch\?v=|youtu\.be\/)([\w-]{11})/);
        if (youtubeMatch) {
          const videoId = youtubeMatch[1];
          return (
            <div className="my-4">
              <iframe
                width="320"
                height="180"
                src={`https://www.youtube.com/embed/${videoId}`}
                title="YouTube video player"
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                allowFullScreen
                className="rounded-lg shadow-lg"
              ></iframe>
            </div>
          );
        }

        // Regular link handling with different styles based on type
        const isEmail = href?.startsWith('mailto:');
        const isPhone = href?.startsWith('tel:');
        const isExternal = href?.startsWith('http') || href?.startsWith('https');
        
        let linkClass = "inline-flex items-center gap-1 px-2 py-0.5 rounded transition-colors ";
        let icon = null;
        
        if (isEmail) {
          linkClass += "bg-primary/10 text-primary hover:bg-primary/20";
          icon = "ðŸ“§";
        } else if (isPhone) {
          linkClass += "bg-secondary/10 text-secondary hover:bg-secondary/20";
          icon = "ðŸ“ž";
        } else if (isExternal) {
          linkClass += "bg-accent/10 text-accent hover:bg-accent/20";
          icon = <LinkIcon className="h-3 w-3" />;
        } else {
          linkClass += "bg-muted text-muted-foreground hover:bg-muted/80";
        }

        return (
          <a 
            href={href}
            className={linkClass}
            target={isExternal ? "_blank" : undefined}
            rel={isExternal ? "noopener noreferrer" : undefined}
          >
            {icon}
            <span className="text-sm">{children}</span>
          </a>
        );
      },
      em: ({ children }) => (
        <em className="italic text-primary">
          {children}
        </em>
      ),
      strong: ({ children }) => (
        <strong className="font-bold text-primary">
          {children}
        </strong>
      ),
    }}
  >
    {content}
  </ReactMarkdown>
);

```

## frontend/components/Chatbot.tsx

```typescript
// frontend/components/Chatbot.tsx
'use client'

import React, { useRef, useCallback, useMemo, useState } from 'react';
import { Button } from "@/components/ui/button";
import { Textarea } from "@/components/ui/textarea";
import { Card, CardHeader, CardTitle, CardContent, CardFooter } from "@/components/ui/card";
import { ScrollArea } from "@/components/ui/scroll-area";
import { Loader2, Send, Trash2, Paperclip } from 'lucide-react';
import ChatMessage from '@/components/ChatMessage';
import { useWebSocket } from '@/lib/hooks/useWebSocket';

const ChatBot: React.FC = () => {
  const [input, setInput] = useState('');
  const scrollAreaRef = useRef<HTMLDivElement>(null);
  const messageEndRef = useRef<HTMLDivElement>(null);

  const {
    messages,
    isLoading,
    isConnected,
    currentAgent,
    sendMessage,
    clearMessages
  } = useWebSocket('ws://localhost:8000/ws');

  const scrollToBottom = useCallback(() => {
    if (messageEndRef.current) {
      messageEndRef.current.scrollIntoView({ behavior: 'smooth' });
    }
  }, []);

  React.useEffect(() => {
    scrollToBottom();
  }, [messages, isLoading, scrollToBottom]);

  const handleSubmit = useCallback(() => {
    if (!input.trim()) return;
    sendMessage(input);
    setInput('');
    // Reset the textarea height to its minimum height
    const textarea = document.querySelector('textarea');
    if (textarea) {
      textarea.style.height = '7.5rem';
    }
  }, [input, sendMessage]);

  const handleUpload = useCallback(() => {
    console.log("File upload triggered");
    // Implement file upload logic here
  }, []);

  const handleKeyDown = useCallback((e: React.KeyboardEvent<HTMLTextAreaElement>) => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      handleSubmit();
    }
  }, [handleSubmit]);

  const messageElements = useMemo(() => (
    messages.map(message => (
      <ChatMessage key={message.id} message={message} />
    ))
  ), [messages]);

  return (
    <div className="flex flex-col h-screen w-4/5 max-w-[55rem] mx-auto max-h-[90vh] rounded-lg overflow-hidden">
      <Card className="flex flex-col h-full">
        <CardHeader className="flex-shrink-0">
          <div className="flex justify-between items-center">
            <CardTitle>AI Chatbot {currentAgent && `(${currentAgent})`}</CardTitle>
            <Button variant="outline" size="icon" onClick={clearMessages} aria-label="Clear chat history">
              <Trash2 className="h-4 w-4" />
            </Button>
          </div>
        </CardHeader>
        <CardContent className="flex-grow overflow-hidden p-0">
          <ScrollArea 
            className="h-full p-4 [&_.scrollbar-thumb]:bg-muted-foreground/50 [&_.scrollbar-thumb]:hover:bg-muted-foreground/80" 
            ref={scrollAreaRef}
          >
            {messageElements}
            {isLoading && (
              <div className="flex justify-start mb-4">
                <div className="bg-secondary text-secondary-foreground rounded-lg p-3 flex items-center">
                  <Loader2 className="h-4 w-4 animate-spin mr-2" />
                </div>
              </div>
            )}
            <div ref={messageEndRef} />
          </ScrollArea>
        </CardContent>
        <CardFooter className="flex-shrink-0 p-2">
          <form onSubmit={(e) => { e.preventDefault(); handleSubmit(); }} className="w-full">
            <div className="relative w-full">
              <Textarea
                value={input}
                onChange={(e) => {
                  setInput(e.target.value);
                  e.target.style.height = 'auto';
                  e.target.style.height = `${e.target.scrollHeight}px`;
                }}
                onKeyDown={handleKeyDown}
                placeholder="Type your message..."
                className="pr-24 border resize-none rounded-md w-full overflow-hidden"
                rows={1}
                aria-label="Chat input"
                style={{ minHeight: '7.5rem', maxHeight: '30rem' }}
              />
              <div className="absolute bottom-2 right-2 flex space-x-2">
                <Button
                  type="button"
                  variant="ghost"
                  size="icon"
                  className="h-8 w-8"
                  onClick={handleUpload}
                  disabled={isLoading || !isConnected}
                >
                  <Paperclip className="h-4 w-4" />
                  <span className="sr-only">Attach file</span>
                </Button>
                <Button 
                  type="submit" 
                  variant="ghost" 
                  size="icon" 
                  className="h-8 w-8"
                  disabled={isLoading || !isConnected}
                >
                  <Send className="h-4 w-4" />
                  <span className="sr-only">Send message</span>
                </Button>
              </div>
            </div>
          </form>
        </CardFooter>
      </Card>
    </div>
  );
};

export default ChatBot;

```

## frontend/components/ChatMessage.tsx

```typescript
import React from 'react';
import type { Message } from '@/lib/hooks/useWebSocket';
import { CustomMarkdown } from '@/components/CustomMarkdown';

interface ChatMessageProps {
  message: Message;
}

export const ChatMessage: React.FC<ChatMessageProps> = React.memo(({ message }) => (
  <div className={`flex ${message.role === 'user' ? 'justify-end' : 'justify-start'} mb-4`}>
    <div className={`flex items-start pt-5 gap-2 max-w-[100%] ${message.role === 'user' ? 'flex-row-reverse' : 'flex-row'}`}>
      <div className="flex-shrink-0">
        <img
          src={message.role === 'user' ? '/images/user-avatar.png' : '/images/bot-avatar.png'}
          alt={`${message.role} avatar`}
          className="w-10 h-10 rounded-full"
        />
      </div>
      <div className={`rounded-lg p-3 ${
        message.role === 'user' 
          ? 'bg-secondary text-secondary-foreground border' 
          : 'bg-secondary text-secondary-foreground'
      }`}>
        <CustomMarkdown content={message.content} />
        <p className="text-xs mt-2 opacity-50">
          {message.timestamp.toLocaleTimeString()}
        </p>
      </div>
    </div>
  </div>
));

ChatMessage.displayName = 'ChatMessage';

export default ChatMessage;

```

## frontend/components/CustomCodeBlock.tsx

```typescript
import React from 'react';
import { Prism as SyntaxHighlighter } from 'react-syntax-highlighter';
import { vscDarkPlus } from 'react-syntax-highlighter/dist/esm/styles/prism';

const customCodeStyle = {
  ...vscDarkPlus,
};

const customWrapperStyle = {
  'pre[class*="language-"]': {
    ...vscDarkPlus['pre[class*="language-"]'],
    padding: '1rem',
    margin: '0.5rem 0',
    background: 'hsl(var(--secondary))',
    border: '1px solid hsl(var(--border))',
    borderRadius: 'calc(var(--radius) - 2px)',
    overflowX: 'auto',
    whiteSpace: 'pre',
  },
  ':not(pre) > code[class*="language-"]': {
    ...vscDarkPlus[':not(pre) > code[class*="language-"]'],
    background: 'hsl(var(--secondary))',
    padding: '0.2em 0.4em',
    borderRadius: 'calc(var(--radius) - 4px)',
  },
};

export const CustomCodeBlock = ({ inline, className, children, ...props }: any) => {
  const match = /language-(\w+)/.exec(className || '');
  return !inline && match ? (
    <div className="relative rounded-md overflow-x-auto my-4">
      <SyntaxHighlighter
        style={customCodeStyle}
        language={match[1]}
        PreTag="div"
        wrapperStyle={customWrapperStyle}
        customStyle={{
          margin: 0,
          background: 'hsl(var(--secondary))',
          overflowX: 'auto', // Ensure overflow is set to auto here as well
        }}
        className="scrollbar-custom p-4"
        {...props}
      >
        {String(children).replace(/\n$/, '')}
      </SyntaxHighlighter>
    </div>
  ) : (
    <code className="bg-secondary px-1.5 py-0.5 rounded-md text-sm" {...props}>
      {children}
    </code>
  );
};

```

## frontend/components/CustomWeatherCard.tsx

```typescript
// frontend/components/CustomWeatherCard.tsx

import React from 'react';

interface WeatherData {
  location: string;
  temperature_c: string;
  temperature_f: string;
  condition: string;
  icon_url?: string;
  humidity?: string;
  wind_kph?: string;
  wind_mph?: string;
  last_updated?: string;
  [key: string]: any;
}

interface CustomWeatherCardProps {
  data: WeatherData;
}

export const CustomWeatherCard: React.FC<CustomWeatherCardProps> = ({ data }) => (
  <div className="p-4 bg-secondary text-secondary-foreground rounded-md border">
    <h2 className="text-lg font-bold">{data.location}</h2>
    <div className="flex items-center mt-2">
      {data.icon_url && (
        <img
          src={data.icon_url}
          alt={data.condition}
          className="w-16 h-16 mr-4"
        />
      )}
      <div>
        <p className="text-4xl font-bold">{data.temperature_c}</p>
        <p className="capitalize">{data.condition}</p>
      </div>
    </div>
    {/* Additional weather details */}
    <div className="mt-2">
      {data.humidity && <p>Humidity: {data.humidity}</p>}
      {data.wind_kph && <p>Wind: {data.wind_kph}</p>}
      {data.last_updated && <p>Last Updated: {data.last_updated}</p>}
    </div>
  </div>
);

export default CustomWeatherCard;

```

## frontend/lib/utils.ts

```typescript
import { clsx, type ClassValue } from "clsx"
import { twMerge } from "tailwind-merge"

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs))
}

```

## frontend/lib/hooks/useWebSocket.ts

```typescript
import { useState, useEffect, useCallback, useRef } from 'react';

interface Message {
  id: string;
  role: 'user' | 'assistant';
  content: string;
  timestamp: Date;
}

interface WebSocketHookReturn {
  messages: Message[];
  isLoading: boolean;
  isConnected: boolean;
  currentAgent: string;
  sendMessage: (content: string) => void;
  clearMessages: () => void;
}

export const useWebSocket = (url: string): WebSocketHookReturn => {
  const [messages, setMessages] = useState<Message[]>([]);
  const [isLoading, setIsLoading] = useState(false);
  const [isConnected, setIsConnected] = useState(false);
  const [currentAgent, setCurrentAgent] = useState('');
  const [ws, setWs] = useState<WebSocket | null>(null);
  const reconnectTimeoutRef = useRef<NodeJS.Timeout>();

  const connectWebSocket = useCallback(() => {
    const socket = new WebSocket(url);
    setWs(socket);

    socket.onopen = () => {
      console.log('WebSocket connection established');
      setIsConnected(true);
    };

    socket.onmessage = (event) => {
      const data = JSON.parse(event.data);
      if (data.type === 'content') {
        setMessages(prevMessages => {
          const lastMessage = prevMessages[prevMessages.length - 1];
          if (lastMessage && lastMessage.role === 'assistant') {
            return [
              ...prevMessages.slice(0, -1),
              { ...lastMessage, content: lastMessage.content + data.content }
            ];
          } else {
            return [...prevMessages, {
              id: Date.now().toString(),
              role: 'assistant',
              content: data.content,
              timestamp: new Date()
            }];
          }
        });
        setIsLoading(false);
      } else if (data.type === 'agent_change') {
        setCurrentAgent(data.agent);
      } else if (data.type === 'end') {
        setIsLoading(false);
      }
    };

    socket.onclose = () => {
      console.log('WebSocket connection closed');
      setIsConnected(false);
      reconnectTimeoutRef.current = setTimeout(connectWebSocket, 5000);
    };

    socket.onerror = (error) => {
      console.error('WebSocket error:', error);
      socket.close();
    };
  }, [url]);

  useEffect(() => {
    connectWebSocket();

    return () => {
      if (ws) {
        ws.close();
      }
      if (reconnectTimeoutRef.current) {
        clearTimeout(reconnectTimeoutRef.current);
      }
    };
  }, [connectWebSocket]);

  const sendMessage = useCallback((content: string) => {
    if (!content.trim() || !ws || !isConnected) return;

    const userMessage: Message = {
      id: Date.now().toString(),
      role: 'user',
      content,
      timestamp: new Date()
    };
    setMessages(prevMessages => [...prevMessages, userMessage]);
    setIsLoading(true);

    // Get the last 4 interactions (8 messages, as each interaction has a user and assistant message)
    const lastMessages = messages.slice(-8).concat(userMessage);

    // Send the last 4 interactions along with the new message
    ws.send(JSON.stringify({
      message: content,
      history: lastMessages
    }));
  }, [ws, isConnected, messages]);

  const clearMessages = useCallback(() => {
    setMessages([]);
  }, []);

  return {
    messages,
    isLoading,
    isConnected,
    currentAgent,
    sendMessage,
    clearMessages
  };
};

export type { Message };

```

